<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Jedi - Decluttering Java - Examples</title>
    <!-- Include SyntaxHighlighter required JS files -->
    <script type="text/javascript" src="js/shCore.js"></script>
    <script type="text/javascript" src="js/shBrushJava.js"></script>
    <script type="text/javascript" src="js/shBrushCpp.js"></script>
    <link href="css/shCore.css" rel="stylesheet" type="text/css"/>
    <link href="css/shThemeDefault.css" rel="stylesheet" type="text/css"/>

    <!-- our basic stylesheet -->
    <link rel="stylesheet" href="css/style.css" type="text/css"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="author" content="Lance Walton" lang="en-uk"/>
</head>
<body>
<div class="main">
<div class="pageTitle">Jedi Examples</div>
<div class="contents">
    <ul>
        <li><a href="#quickSort" title="Quick Sort">Quick Sort</a>
        </li>
        <li><a href="#stormtroopers" title="Stormtroopers">Stormtroopers</a>
        </li>
        <li><a href="#option" title="Option">Option</a>
        </li>
        <li><a href="index.html" title="Back to Jedi">Back to Jedi</a>
        </li>
    </ul>
</div>

<p>More examples can be found in the 'examples' directory of the distribution. The 'empire' example found there includes
    an <a href="http://ant.apache.org/"
          title="Ant homepage"> Ant</a> build file, showing the use of the <code>apt</code> task for both JDK 1.4 and
    JDK 1.5 targets.</p>

<div class="sectionHeading"><a name="quickSort">Quick Sort</a>
</div>
<p>Here is a quick sort in Haskell:</p>
<pre class="brush: java">
qsort [] = []
qsort (x:xs) = qsort (filter (< x) xs) ++ [x] ++ qsort (filter (<= x) xs)
</pre>

<p>There is no way Java can beat Haskell here but here it is with Jedi:</p>
<pre class="brush: java">
public static &lt;T&gt; Collection&lt;T&gt; sort(Collection&lt;T&gt; collection, Comparator&lt;T&gt; comparator) {
 if (collection.size() < 2) {
  return collection;
 }
 T head = head(collection);
 List&lt;T&gt; tail = tail(collection);
 List&lt;T&gt; lower = select(tail, lessThan(head, comparator));
 List&lt;T&gt; upper = select(tail, not(lessThan(head, comparator)));
 return append(sort(lower, comparator), list(head), sort(upper, comparator));
}
</pre>
<p>Both the Haskell and Jedi examples communicate what is going on and is understandable even if the reader did not know
    how the Quick sort works.</p>

<p>Here it is in C which is pretty much how it would look in Java:</p>
<pre class="brush: cpp">
void qsort(int a[], int lo, int hi) {
{
 int h, l, p, t;

 if (lo < hi) {
 l = lo;
 h = hi;
 p = a[hi];

 do {
  while ((l < h) && (a[l] <= p))
   l = l+1;
  while ((h > l) && (a[h] >= p))
   h = h-1;
  if (l < h) {
   t = a[l];
   a[l] = a[h];
   a[h] = t;
  }
 } while (l < h);

 t = a[l];
 a[l] = a[hi];
 a[hi] = t;

 qsort( a, lo, l-1 );
 qsort( a, l+1, hi );
 }
}
</pre>

<div class="sectionHeading"><a name="stormtroopers">Storm Troopers</a>
</div>
<p>Suppose you have a galactic empire policed by stormtroopers and you wanted to tell all stormtroopers that are
    currently in the vicinity of the planet Dantooine (which you
    intend to destroy as a demonstration of the power of your new Death Star) to return to the Death Star. You might
    (using JDK 1.5) conventionally write something like
    this:</p>
<pre class="brush: java">
public class Empire {
  private Set&lt;Stormtrooper&gt; stormtroopers;
  private Planet planetToBlowUpNext;

  // meanwhile …

  public void extractStormtroopers() {
    for (Stormtrooper stormtrooper : stormtroopers) {
      if ( stormtrooper.isCloseTo( planetToBlowUpNext)) {
        stormtrooper.returnToDeathStar();
      }
    }
  }
}
</pre>
<p>Code like that seen in the <code>extractStormtroopers()</code> method can be found in pretty much all Java projects
    world-wide. It suffers from the following
    problems:</p>
<ul>
    <li>Logic for iteration, querying and commanding are intermingled and are therefore not independently usable.</li>
    <li>Because of the above, you will see repetitions of the 'loop over stormtroopers' code in several methods, with a
        different condition and / or a different command
        applied.
    </li>
    <li>Because of the above, structurally similar unit tests will also be repeated.</li>
</ul>
<p>Using Jedi, the 5 lines of code in the <code>extractStormtroopers()</code> method above can be reduced to this rather
    more expressive and compact version:</p>
<pre class="brush: java">
public class Empire {
  private Set&lt;Stormtrooper&gt; stormtroopers;
  private Planet planetToBlowUpNext;

  // in a galaxy far away…

  public void extractStormtroopers() {
    Collection&lt;Stormtrooper&gt; endangeredStormtroopers = select(stormtroopers, closeToFilter(planetToBlowUpNext));
    forEach(endangeredStormtroopers, returnToDeathStarCommand());
  }
}
</pre>
<p>Of course, once you are used to the <a href="javadoc/index.html" title="Jedi JavaDoc">API</a>
    , you could inline the <code>endangeredStormtroopers</code> variable, reducing the original 5 lines of code to 1,
    and a <a
            href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"
            title="Wikipedia page about Cyclomatic Complexity"> cyclomatic complexity</a>
    reduction of 3 to 1. This scale of complexity reduction is common with Jedi.</p>

<p>The <code>xxxCommand()</code> and <code>xxxFilter()</code> methods are factory methods created by Jedi due to
    annotations added to the <code>Stormtrooper</code>
    class:</p>
<pre class="brush: java">
public class Stormtrooper {

  // stuff omitted

  @JediFilter
  public boolean isCloseTo(Planet planet) { … }

  @JediCommand
  public void returnToDeathStar() { … }
}
</pre>
<p>They are used in the <code>Empire</code> code above using <code>static import</code>s for brevity (not shown).</p>

<div class="sectionHeading"><a name="option">Option</a>
</div>
<p>Everyone has come across nasty code like this in many languages:</p>
<pre class="brush: java">
String foo = map.get("key");
if (foo == null) {
  throw new WhatsItException("Where's the foo");
}
// use foo
</pre>
<p>These situations occur during lazy initialisation, retrieving values from maps, retrieving data from a database. It's
    everywhere and it's nasty.</p>

<p>The reason it's nasty is that a null reference sits around waiting for some unfortunate code to dereference it. The
    even more
    unfortunate programmer has to then figure where it came from which is not always trivial.</p>

<p>This is where <i>Option</i> comes in. Let's rewrite the above code block:</p>
<pre class="brush: java">
Option&lt;String&gt; foo = Options.get(map, "key");
foo.match(new OptionMatcher() {
  public void caseSome(String value) { // excellent we can use the value }
  public void caseNone() { throw new WhatsItException("Where's the foo?"); }
});
</pre>
<p>The point is that there are no <code>null</code>s in this code and the possibility that the value may not exist has
    to be dealt with.</p>

<p>This is JEDI though, so there is also another way to use Options:</p>
<pre class="brush: java">
Option&lt;String&gt; foo = Options.get(map, "key");
foo.match(someCommand, noneCommand);
</pre>
<p>Where <code>someCommand</code> and <code>noneCommand</code> are Commands to be executed depending on whether <code>foo</code>
    is a Some or None. (The commands could be generated by annotations against existing methods of course.)
    The <code>someCommand</code> will be given the actual value contained in the Some instance so it does not
    need to match on an Option. This can be much more concise with a static import:</p>
<pre class="brush: java">
get(map, "key").match(someCommand, noneCommand);
</pre>
<p>Another use is performing some action if a value exists. Normally this requires a null check. In Jedi, with Commands
    and Option:</p>
<pre class="brush: java">
Option&lt;String&gt; foo = ...
foo.forEach(commandTakingString);
</pre>
<p>Finally, tired of testing for null in equals methods?</p>
<pre class="brush: java">
    public boolean equals(Object other) {
        // usual stuff
        
    }
</pre>
<p>To learn more about Optional values, read:</p>
<ul>
    <li><a href="http://www.scala-lang.org/docu/files/api/scala/Option.html">The Scala Option Scaladoc</a></li>
    <li><a href=http://blog.danielwellman.com/2008/03/using-scalas-op.html>Using Scala's Option class to help avoid
        NullPointerExceptions</a></li>
    <li><a href="http://blog.lostlake.org/index.php?/archives/50-The-Scala-Option-class-and-how-lift-uses-it.html">The
        Scala Option class and how lift uses it</a></li>
    <li><a href="http://blog.tmorris.net/scalaoption-cheat-sheet/">scala.Option Cheat Sheet</a></li>
</ul>
</div>
<script type="text/javascript">
    //<![CDATA[
    SyntaxHighlighter.all()
    //]]>
</script>
</body>
</html>